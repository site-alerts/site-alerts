// =====================================================
// Admin UI - Input Groups
// =====================================================

@use "../prefix" as *;
@use "../base/variables" as *;

.#{$prefix}-input-group {
  position: relative;
  display: flex;
  flex-wrap: wrap;
  align-items: stretch;
  width: 100%;
  border-radius: $sa-input-border-radius;

  > .#{$prefix}-form-control,
  > .#{$prefix}-form-select {
    position: relative;
    flex: 1 1 auto;
    width: 1%;
    min-width: 0;
  }

  // Focus state for entire group
  &:focus-within {
    box-shadow: 0 0 0 $sa-input-border-width #{css-var('primary')};

    &::before {
      box-shadow: 0 0.125rem 0.375rem 0 rgba(#{css-var('primary-rgb')}, 0.3);
    }

    .#{$prefix}-input-group-text,
    .#{$prefix}-form-control,
    .#{$prefix}-form-select {
      border-color: #{css-var('primary')};
    }
  }

  // Hover state
  &:hover:not(:focus-within) {
    .#{$prefix}-input-group-text,
    .#{$prefix}-form-control,
    .#{$prefix}-form-select {
      border-color: $sa-input-hover-border-color;
    }
  }

  // Pseudo element for shadow
  &::before {
    position: absolute;
    display: block;
    width: 100%;
    height: 100%;
    top: 0;
    left: 0;
    content: "";
    border-radius: $sa-input-border-radius;
    pointer-events: none;
  }

  // Input group sizing
  &.#{$prefix}-input-group-lg {
    &,
    &::before {
      border-radius: $sa-input-border-radius-lg;
    }

    > .#{$prefix}-form-control,
    > .#{$prefix}-form-select {
      min-height: $sa-input-height-lg;
      padding: $sa-input-padding-y-lg $sa-input-padding-x-lg;
      font-size: $sa-input-font-size-lg;
      border-radius: $sa-input-border-radius-lg;
    }

    > .#{$prefix}-input-group-text {
      padding: $sa-input-padding-y-lg $sa-input-padding-x-lg;
      font-size: $sa-input-font-size-lg;
    }
  }

  &.#{$prefix}-input-group-sm {
    &,
    &::before {
      border-radius: $sa-input-border-radius-sm;
    }

    > .#{$prefix}-form-control,
    > .#{$prefix}-form-select {
      min-height: $sa-input-height-sm;
      padding: $sa-input-padding-y-sm $sa-input-padding-x-sm;
      font-size: $sa-input-font-size-sm;
      border-radius: $sa-input-border-radius-sm;
    }

    > .#{$prefix}-input-group-text {
      padding: $sa-input-padding-y-sm $sa-input-padding-x-sm;
      font-size: $sa-input-font-size-sm;
    }
  }

  // Rounded corners handling
  > :not(:first-child):not(.#{$prefix}-dropdown-menu):not(.#{$prefix}-valid-tooltip):not(.#{$prefix}-valid-feedback):not(.#{$prefix}-invalid-tooltip):not(.#{$prefix}-invalid-feedback) {
    margin-left: calc(#{$sa-input-border-width} * -1);
    border-top-left-radius: 0;
    border-bottom-left-radius: 0;
  }

  > :not(:last-child):not(.#{$prefix}-dropdown-menu):not(.#{$prefix}-valid-tooltip):not(.#{$prefix}-valid-feedback):not(.#{$prefix}-invalid-tooltip):not(.#{$prefix}-invalid-feedback) {
    border-top-right-radius: 0;
    border-bottom-right-radius: 0;
  }

  // Prevent double focus styling
  > .#{$prefix}-form-control,
  > .#{$prefix}-form-select,
  > .#{$prefix}-input-group-text {
    &:focus,
    &:focus-within {
      border-width: $sa-input-border-width;
      box-shadow: none;
    }
  }
}

// Input Group Text (addon)
.#{$prefix}-input-group-text {
  display: flex;
  align-items: center;
  padding: calc(#{$sa-input-padding-y} - #{$sa-input-border-width}) calc(#{$sa-input-padding-x} - #{$sa-input-border-width});
  font-size: $sa-input-font-size;
  font-weight: $sa-font-weight-normal;
  line-height: $sa-input-line-height;
  color: #{css-var('body-color')};
  text-align: center;
  white-space: nowrap;
  background-color: transparent;
  background-clip: padding-box;
  border: $sa-input-border-width solid #{css-var('border-color')};
  border-radius: $sa-input-border-radius;
  transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;

  // Icon sizing
  .dashicons,
  [class^="ti-"],
  [class*=" ti-"] {
    font-size: 1.25rem;
    width: 1.25rem;
    height: 1.25rem;
  }
}

// Merged Input Group (no visible borders between elements)
.#{$prefix}-input-group-merge {
  .#{$prefix}-input-group-text,
  .#{$prefix}-form-control,
  .#{$prefix}-form-select {
    &:first-child {
      border-right: 0;
    }

    &:last-child {
      border-left: 0;
    }

    &:not(:first-child) {
      border-left: 0;
      padding-left: 0;
    }

    &:not(:last-child) {
      border-right: 0;
    }
  }
}

// Disabled Input Group
.#{$prefix}-input-group.disabled,
.#{$prefix}-input-group[disabled] {
  .#{$prefix}-input-group-text,
  .#{$prefix}-form-control,
  .#{$prefix}-form-select {
    border-color: #{css-var('input-disabled-border')};
    background-color: #{css-var('input-disabled-bg')};
    color: #{css-var('secondary-color')};
    pointer-events: none;
  }
}

// Rounded pill style
.#{$prefix}-input-group.#{$prefix}-rounded-pill {
  .#{$prefix}-input-group-text,
  .#{$prefix}-form-control,
  .#{$prefix}-form-select,
  &::before {
    border-radius: $sa-border-radius-pill;
  }

  > :not(:first-child):not(.#{$prefix}-dropdown-menu):not(.#{$prefix}-valid-tooltip):not(.#{$prefix}-valid-feedback):not(.#{$prefix}-invalid-tooltip):not(.#{$prefix}-invalid-feedback) {
    border-top-left-radius: 0;
    border-bottom-left-radius: 0;
  }

  > :not(:last-child):not(.#{$prefix}-dropdown-menu):not(.#{$prefix}-valid-tooltip):not(.#{$prefix}-valid-feedback):not(.#{$prefix}-invalid-tooltip):not(.#{$prefix}-invalid-feedback) {
    border-top-right-radius: 0;
    border-bottom-right-radius: 0;
  }
}

// Input Group with Validation
.#{$prefix}-input-group:has(.#{$prefix}-is-invalid) {
  box-shadow: 0 0 0 $sa-input-border-width $sa-form-feedback-invalid-color;

  .#{$prefix}-input-group-text,
  .#{$prefix}-form-control,
  .#{$prefix}-form-select {
    border-color: $sa-form-feedback-invalid-color;
  }

  &::before {
    box-shadow: 0 0.125rem 0.375rem 0 rgba($sa-form-feedback-invalid-color, 0.3);
  }

  ~ .#{$prefix}-invalid-feedback,
  ~ .#{$prefix}-invalid-tooltip {
    display: block;
  }
}

.#{$prefix}-input-group:has(.#{$prefix}-is-valid) {
  box-shadow: 0 0 0 $sa-input-border-width $sa-form-feedback-valid-color;

  .#{$prefix}-input-group-text,
  .#{$prefix}-form-control,
  .#{$prefix}-form-select {
    border-color: $sa-form-feedback-valid-color;
  }

  &::before {
    box-shadow: 0 0.125rem 0.375rem 0 rgba($sa-form-feedback-valid-color, 0.3);
  }

  ~ .#{$prefix}-valid-feedback,
  ~ .#{$prefix}-valid-tooltip {
    display: block;
  }
}
